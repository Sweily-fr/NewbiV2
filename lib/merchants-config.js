// Configuration des marchands avec leurs logos et patterns de reconnaissance
export const MERCHANTS = {
  free: {
    name: "Free",
    logo: "https://logo.clearbit.com/free.fr",
    color: "#E20714",
    patterns: ["free", "free mobile", "free telecom", "iliad"]
  },
  ovh: {
    name: "OVHcloud",
    logo: "https://logo.clearbit.com/ovhcloud.com",
    color: "#123F6D",
    patterns: ["ovh", "ovhcloud", "ovh cloud"]
  },
  amazon: {
    name: "Amazon",
    logo: "https://logo.clearbit.com/amazon.fr",
    color: "#FF9900",
    patterns: ["amazon", "amzn", "amazon.fr", "amazon.com"]
  },
  netflix: {
    name: "Netflix",
    logo: "https://logo.clearbit.com/netflix.com",
    color: "#E50914",
    patterns: ["netflix"]
  },
  spotify: {
    name: "Spotify",
    logo: "https://logo.clearbit.com/spotify.com",
    color: "#1DB954",
    patterns: ["spotify"]
  },
  google: {
    name: "Google",
    logo: "https://logo.clearbit.com/google.com",
    color: "#4285F4",
    patterns: ["google", "google cloud", "gcp", "google workspace"]
  },
  microsoft: {
    name: "Microsoft",
    logo: "https://logo.clearbit.com/microsoft.com",
    color: "#00A4EF",
    patterns: ["microsoft", "office 365", "azure", "ms"]
  },
  apple: {
    name: "Apple",
    logo: "https://logo.clearbit.com/apple.com",
    color: "#000000",
    patterns: ["apple", "app store", "itunes"]
  },
  uber: {
    name: "Uber",
    logo: "https://logo.clearbit.com/uber.com",
    color: "#000000",
    patterns: ["uber", "uber eats"]
  },
  deliveroo: {
    name: "Deliveroo",
    logo: "https://logo.clearbit.com/deliveroo.fr",
    color: "#00CCBC",
    patterns: ["deliveroo"]
  },
  sncf: {
    name: "SNCF",
    logo: "https://logo.clearbit.com/sncf.com",
    color: "#82BE00",
    patterns: ["sncf", "ouigo", "tgv"]
  },
  airfrance: {
    name: "Air France",
    logo: "https://logo.clearbit.com/airfrance.fr",
    color: "#002157",
    patterns: ["air france", "airfrance"]
  },
  edf: {
    name: "EDF",
    logo: "https://logo.clearbit.com/edf.fr",
    color: "#FF6600",
    patterns: ["edf", "electricite de france"]
  },
  orange: {
    name: "Orange",
    logo: "https://logo.clearbit.com/orange.fr",
    color: "#FF7900",
    patterns: ["orange", "orange telecom"]
  },
  bouygues: {
    name: "Bouygues Telecom",
    logo: "https://logo.clearbit.com/bouyguestelecom.fr",
    color: "#009DE0",
    patterns: ["bouygues", "bouygues telecom"]
  },
  sfr: {
    name: "SFR",
    logo: "https://logo.clearbit.com/sfr.fr",
    color: "#E20714",
    patterns: ["sfr", "red by sfr"]
  },
  github: {
    name: "GitHub",
    logo: "https://logo.clearbit.com/github.com",
    color: "#181717",
    patterns: ["github"]
  },
  slack: {
    name: "Slack",
    logo: "https://logo.clearbit.com/slack.com",
    color: "#4A154B",
    patterns: ["slack"]
  },
  notion: {
    name: "Notion",
    logo: "https://logo.clearbit.com/notion.so",
    color: "#000000",
    patterns: ["notion"]
  },
  figma: {
    name: "Figma",
    logo: "https://logo.clearbit.com/figma.com",
    color: "#F24E1E",
    patterns: ["figma"]
  },
  linkedin: {
    name: "LinkedIn",
    logo: "https://logo.clearbit.com/linkedin.com",
    color: "#0A66C2",
    patterns: ["linkedin"]
  },
  dropbox: {
    name: "Dropbox",
    logo: "https://logo.clearbit.com/dropbox.com",
    color: "#0061FF",
    patterns: ["dropbox"]
  },
  zoom: {
    name: "Zoom",
    logo: "https://logo.clearbit.com/zoom.us",
    color: "#2D8CFF",
    patterns: ["zoom"]
  },
  stripe: {
    name: "Stripe",
    logo: "https://logo.clearbit.com/stripe.com",
    color: "#635BFF",
    patterns: ["stripe"]
  },
  paypal: {
    name: "PayPal",
    logo: "https://logo.clearbit.com/paypal.com",
    color: "#00457C",
    patterns: ["paypal"]
  },
  adobe: {
    name: "Adobe",
    logo: "https://logo.clearbit.com/adobe.com",
    color: "#FF0000",
    patterns: ["adobe", "creative cloud"]
  },
  salesforce: {
    name: "Salesforce",
    logo: "https://logo.clearbit.com/salesforce.com",
    color: "#00A1E0",
    patterns: ["salesforce"]
  },
  mailchimp: {
    name: "Mailchimp",
    logo: "https://logo.clearbit.com/mailchimp.com",
    color: "#FFE01B",
    patterns: ["mailchimp"]
  },
  hubspot: {
    name: "HubSpot",
    logo: "https://logo.clearbit.com/hubspot.com",
    color: "#FF7A59",
    patterns: ["hubspot"]
  },
  shopify: {
    name: "Shopify",
    logo: "https://logo.clearbit.com/shopify.com",
    color: "#96BF48",
    patterns: ["shopify"]
  },
  wix: {
    name: "Wix",
    logo: "https://logo.clearbit.com/wix.com",
    color: "#0C6EFC",
    patterns: ["wix"]
  },
  wordpress: {
    name: "WordPress",
    logo: "https://logo.clearbit.com/wordpress.com",
    color: "#21759B",
    patterns: ["wordpress", "wp"]
  },
  heroku: {
    name: "Heroku",
    logo: "https://logo.clearbit.com/heroku.com",
    color: "#430098",
    patterns: ["heroku"]
  },
  aws: {
    name: "AWS",
    logo: "https://logo.clearbit.com/aws.amazon.com",
    color: "#FF9900",
    patterns: ["aws", "amazon web services"]
  },
  vercel: {
    name: "Vercel",
    logo: "https://logo.clearbit.com/vercel.com",
    color: "#000000",
    patterns: ["vercel"]
  },
  netlify: {
    name: "Netlify",
    logo: "https://logo.clearbit.com/netlify.com",
    color: "#00C7B7",
    patterns: ["netlify"]
  },
  digitalocean: {
    name: "DigitalOcean",
    logo: "https://logo.clearbit.com/digitalocean.com",
    color: "#0080FF",
    patterns: ["digitalocean", "digital ocean"]
  },
  cloudflare: {
    name: "Cloudflare",
    logo: "https://logo.clearbit.com/cloudflare.com",
    color: "#F38020",
    patterns: ["cloudflare"]
  },
  twilio: {
    name: "Twilio",
    logo: "https://logo.clearbit.com/twilio.com",
    color: "#F22F46",
    patterns: ["twilio"]
  },
  sendgrid: {
    name: "SendGrid",
    logo: "https://logo.clearbit.com/sendgrid.com",
    color: "#1A82E2",
    patterns: ["sendgrid"]
  },
  intercom: {
    name: "Intercom",
    logo: "https://logo.clearbit.com/intercom.com",
    color: "#1F8DED",
    patterns: ["intercom"]
  },
  zendesk: {
    name: "Zendesk",
    logo: "https://logo.clearbit.com/zendesk.com",
    color: "#03363D",
    patterns: ["zendesk"]
  },
};

/**
 * Trouve un marchand correspondant à une description
 * @param {string} description - Description de la transaction
 * @returns {object|null} - Informations du marchand ou null
 */
export function findMerchant(description) {
  if (!description || typeof description !== 'string') {
    return null;
  }

  const normalized = description.toLowerCase().trim();

  for (const [key, merchant] of Object.entries(MERCHANTS)) {
    if (merchant.patterns.some(pattern => normalized.includes(pattern))) {
      return {
        ...merchant,
        key,
      };
    }
  }

  return null;
}

/**
 * Enrichit une dépense avec les informations du marchand
 * @param {object} expense - Dépense à enrichir
 * @returns {object} - Dépense enrichie
 */
export function enrichExpenseWithMerchant(expense) {
  const merchant = findMerchant(expense.description || expense.notes);
  
  return {
    ...expense,
    merchant: merchant || null,
  };
}

/**
 * Enrichit un tableau de dépenses avec les informations des marchands
 * @param {array} expenses - Tableau de dépenses
 * @returns {array} - Tableau de dépenses enrichies
 */
export function enrichExpensesWithMerchants(expenses) {
  if (!Array.isArray(expenses)) {
    return [];
  }

  return expenses.map(enrichExpenseWithMerchant);
}
