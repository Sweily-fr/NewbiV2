// Configuration des marchands avec leurs logos et patterns de reconnaissance
// Utilisation de Brandfetch pour des logos PNG transparents de meilleure qualité
export const MERCHANTS = {
  free: {
    name: "Free",
    logo: "https://cdn.brandfetch.io/free.fr/w/400/h/400",
    color: "#E20714",
    patterns: ["free", "free mobile", "free telecom", "iliad"]
  },
  ovh: {
    name: "OVHcloud",
    logo: "https://cdn.brandfetch.io/ovhcloud.com/w/400/h/400",
    color: "#123F6D",
    patterns: ["ovh", "ovhcloud", "ovh cloud"]
  },
  amazon: {
    name: "Amazon",
    logo: "https://cdn.brandfetch.io/amazon.com/w/400/h/400",
    color: "#FF9900",
    patterns: ["amazon", "amzn", "amazon.fr", "amazon.com"]
  },
  netflix: {
    name: "Netflix",
    logo: "https://cdn.brandfetch.io/netflix.com/w/400/h/400",
    color: "#E50914",
    patterns: ["netflix"]
  },
  spotify: {
    name: "Spotify",
    logo: "https://cdn.brandfetch.io/spotify.com/w/400/h/400",
    color: "#1DB954",
    patterns: ["spotify"]
  },
  google: {
    name: "Google",
    logo: "https://cdn.brandfetch.io/google.com/w/400/h/400",
    color: "#4285F4",
    patterns: ["google", "google cloud", "gcp", "google workspace"]
  },
  microsoft: {
    name: "Microsoft",
    logo: "https://cdn.brandfetch.io/microsoft.com/w/400/h/400",
    color: "#00A4EF",
    patterns: ["microsoft", "office 365", "azure", "ms"]
  },
  apple: {
    name: "Apple",
    logo: "https://cdn.brandfetch.io/apple.com/w/400/h/400",
    color: "#000000",
    patterns: ["apple", "app store", "itunes"]
  },
  uber: {
    name: "Uber",
    logo: "https://cdn.brandfetch.io/uber.com/w/400/h/400",
    color: "#000000",
    patterns: ["uber", "uber eats"]
  },
  deliveroo: {
    name: "Deliveroo",
    logo: "https://cdn.brandfetch.io/deliveroo.com/w/400/h/400",
    color: "#00CCBC",
    patterns: ["deliveroo"]
  },
  sncf: {
    name: "SNCF",
    logo: "https://cdn.brandfetch.io/sncf.com/w/400/h/400",
    color: "#82BE00",
    patterns: ["sncf", "ouigo", "tgv"]
  },
  airfrance: {
    name: "Air France",
    logo: "https://cdn.brandfetch.io/airfrance.fr/w/400/h/400",
    color: "#002157",
    patterns: ["air france", "airfrance"]
  },
  edf: {
    name: "EDF",
    logo: "https://cdn.brandfetch.io/edf.fr/w/400/h/400",
    color: "#FF6600",
    patterns: ["edf", "electricite de france"]
  },
  orange: {
    name: "Orange",
    logo: "https://cdn.brandfetch.io/orange.fr/w/400/h/400",
    color: "#FF7900",
    patterns: ["orange", "orange telecom"]
  },
  bouygues: {
    name: "Bouygues Telecom",
    logo: "https://cdn.brandfetch.io/bouyguestelecom.fr/w/400/h/400",
    color: "#009DE0",
    patterns: ["bouygues", "bouygues telecom"]
  },
  sfr: {
    name: "SFR",
    logo: "https://cdn.brandfetch.io/sfr.fr/w/400/h/400",
    color: "#E20714",
    patterns: ["sfr", "red by sfr"]
  },
  github: {
    name: "GitHub",
    logo: "https://cdn.brandfetch.io/github.com/w/400/h/400",
    color: "#181717",
    patterns: ["github"]
  },
  slack: {
    name: "Slack",
    logo: "https://cdn.brandfetch.io/slack.com/w/400/h/400",
    color: "#4A154B",
    patterns: ["slack"]
  },
  notion: {
    name: "Notion",
    logo: "https://cdn.brandfetch.io/notion.so/w/400/h/400",
    color: "#000000",
    patterns: ["notion"]
  },
  figma: {
    name: "Figma",
    logo: "https://cdn.brandfetch.io/figma.com/w/400/h/400",
    color: "#F24E1E",
    patterns: ["figma"]
  },
  linkedin: {
    name: "LinkedIn",
    logo: "https://cdn.brandfetch.io/linkedin.com/w/400/h/400",
    color: "#0A66C2",
    patterns: ["linkedin"]
  },
  dropbox: {
    name: "Dropbox",
    logo: "https://cdn.brandfetch.io/dropbox.com/w/400/h/400",
    color: "#0061FF",
    patterns: ["dropbox"]
  },
  zoom: {
    name: "Zoom",
    logo: "https://cdn.brandfetch.io/zoom.us/w/400/h/400",
    color: "#2D8CFF",
    patterns: ["zoom"]
  },
  stripe: {
    name: "Stripe",
    logo: "https://cdn.brandfetch.io/stripe.com/w/400/h/400",
    color: "#635BFF",
    patterns: ["stripe"]
  },
  paypal: {
    name: "PayPal",
    logo: "https://cdn.brandfetch.io/paypal.com/w/400/h/400",
    color: "#00457C",
    patterns: ["paypal"]
  },
  adobe: {
    name: "Adobe",
    logo: "https://cdn.brandfetch.io/adobe.com/w/400/h/400",
    color: "#FF0000",
    patterns: ["adobe", "creative cloud"]
  },
  salesforce: {
    name: "Salesforce",
    logo: "https://cdn.brandfetch.io/salesforce.com/w/400/h/400",
    color: "#00A1E0",
    patterns: ["salesforce"]
  },
  mailchimp: {
    name: "Mailchimp",
    logo: "https://cdn.brandfetch.io/mailchimp.com/w/400/h/400",
    color: "#FFE01B",
    patterns: ["mailchimp"]
  },
  hubspot: {
    name: "HubSpot",
    logo: "https://cdn.brandfetch.io/hubspot.com/w/400/h/400",
    color: "#FF7A59",
    patterns: ["hubspot"]
  },
  shopify: {
    name: "Shopify",
    logo: "https://cdn.brandfetch.io/shopify.com/w/400/h/400",
    color: "#96BF48",
    patterns: ["shopify"]
  },
  wix: {
    name: "Wix",
    logo: "https://cdn.brandfetch.io/wix.com/w/400/h/400",
    color: "#0C6EFC",
    patterns: ["wix"]
  },
  wordpress: {
    name: "WordPress",
    logo: "https://cdn.brandfetch.io/wordpress.com/w/400/h/400",
    color: "#21759B",
    patterns: ["wordpress", "wp"]
  },
  heroku: {
    name: "Heroku",
    logo: "https://cdn.brandfetch.io/heroku.com/w/400/h/400",
    color: "#430098",
    patterns: ["heroku"]
  },
  aws: {
    name: "AWS",
    logo: "https://cdn.brandfetch.io/aws.amazon.com/w/400/h/400",
    color: "#FF9900",
    patterns: ["aws", "amazon web services"]
  },
  vercel: {
    name: "Vercel",
    logo: "https://cdn.brandfetch.io/vercel.com/w/400/h/400",
    color: "#000000",
    patterns: ["vercel"]
  },
  netlify: {
    name: "Netlify",
    logo: "https://cdn.brandfetch.io/netlify.com/w/400/h/400",
    color: "#00C7B7",
    patterns: ["netlify"]
  },
  digitalocean: {
    name: "DigitalOcean",
    logo: "https://cdn.brandfetch.io/digitalocean.com/w/400/h/400",
    color: "#0080FF",
    patterns: ["digitalocean", "digital ocean"]
  },
  cloudflare: {
    name: "Cloudflare",
    logo: "https://cdn.brandfetch.io/cloudflare.com/w/400/h/400",
    color: "#F38020",
    patterns: ["cloudflare"]
  },
  twilio: {
    name: "Twilio",
    logo: "https://cdn.brandfetch.io/twilio.com/w/400/h/400",
    color: "#F22F46",
    patterns: ["twilio"]
  },
  sendgrid: {
    name: "SendGrid",
    logo: "https://cdn.brandfetch.io/sendgrid.com/w/400/h/400",
    color: "#1A82E2",
    patterns: ["sendgrid"]
  },
  intercom: {
    name: "Intercom",
    logo: "https://cdn.brandfetch.io/intercom.com/w/400/h/400",
    color: "#1F8DED",
    patterns: ["intercom"]
  },
  zendesk: {
    name: "Zendesk",
    logo: "https://cdn.brandfetch.io/zendesk.com/w/400/h/400",
    color: "#03363D",
    patterns: ["zendesk"]
  },
};

/**
 * Trouve un marchand correspondant à une description
 * @param {string} description - Description de la transaction
 * @returns {object|null} - Informations du marchand ou null
 */
export function findMerchant(description) {
  if (!description || typeof description !== 'string') {
    return null;
  }

  const normalized = description.toLowerCase().trim();

  for (const [key, merchant] of Object.entries(MERCHANTS)) {
    if (merchant.patterns.some(pattern => normalized.includes(pattern))) {
      return {
        ...merchant,
        key,
      };
    }
  }

  return null;
}

/**
 * Enrichit une dépense avec les informations du marchand
 * @param {object} expense - Dépense à enrichir
 * @returns {object} - Dépense enrichie
 */
export function enrichExpenseWithMerchant(expense) {
  const merchant = findMerchant(expense.description || expense.notes);
  
  return {
    ...expense,
    merchant: merchant || null,
  };
}

/**
 * Enrichit un tableau de dépenses avec les informations des marchands
 * @param {array} expenses - Tableau de dépenses
 * @returns {array} - Tableau de dépenses enrichies
 */
export function enrichExpensesWithMerchants(expenses) {
  if (!Array.isArray(expenses)) {
    return [];
  }

  return expenses.map(enrichExpenseWithMerchant);
}
